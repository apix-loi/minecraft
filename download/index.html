<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <title>MCDL</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Lexend Deca", sans-serif;
      }
      #download {
        font: normal 26px "Lexend Deca", Verdana, sans-serif;
        text-align: center;
      }
      .footer {
        font: normal normal 12px "Lexend Deca", Verdana, sans-serif;
        color: #444;
        text-align: center;
      }
      .footer a {
        font: normal bold 12px "Lexend Deca", Verdana, sans-serif;
        color: rgb(255, 0, 119);
      }
      a:link {
        text-decoration: none;
      }
      #file_name,
      #file_size {
        font: 14px "Lexend Deca", Verdana, sans-serif;
        display: block;
      }
    </style>
  </head>

  <body>
    <br /><br />
    <div id="download">
      <a id="linker" href="https://neonsmp.eu.org/download?act=Download_empty">
        <img src="https://dl4.9minecraft.net/download-button.png" border="0" />
      </a>

      <span id="file_name">File name: <strong>Nothing</strong></span>
      -
      <span id="file_size"> File size: <strong>0 MB</strong></span>
    </div>

    <br />
    <div style="padding: 10px" class="footer">
      Copyright Â©
      <a href="https://neonsmp.eu.org/" title="apezNeon">apezNeon</a>
    </div>

    <script>
      const currentYear = new Date().getFullYear();
      const yearElement = document.querySelector(".footer");
      yearElement.innerHTML += " " + currentYear + ".  All rights reserved.";

      const urlParams = new URLSearchParams(window.location.search);
      const fileName = urlParams.get("file");
      const driveId = urlParams.get("drive");
      const fileUrl = urlParams.get("url");

      if (fileName || driveId || fileUrl) {
        if (
          (fileName && driveId) ||
          (fileName && fileUrl) ||
          (driveId && fileUrl)
        ) {
          document.querySelector("#download").innerHTML =
            "Please specify only one of files, drive or url parameter.";
        } else {
          const linkerElement = document.querySelector("#linker");
          const fileNameElement = document.querySelector("#file_name");
          const fileSizeElement = document.querySelector("#file_size");
          let fileDownloadUrl = "";

          if (fileName) {
            fileDownloadUrl = `https://neonsmp.eu.org/files/${fileName}`;
            fileNameElement.innerHTML = `File name: <strong>${fileName}</strong>`;
          } else if (driveId) {
            fileDownloadUrl = `https://drive.google.com/uc?export=download&id=${driveId}`;
            fileNameElement.innerHTML = `File name: <strong>${driveId}</strong>`;
          } else if (fileUrl) {
            const regex = /[^/]*$/;
            const match = fileUrl.match(regex);
            if (match) {
              const filename = match[0];
              fileDownloadUrl = fileUrl;
              fileNameElement.innerHTML = `File name: <strong>${filename}</strong>`;
            } else {
              document.querySelector("#download").innerHTML =
                "Invalid file URL provided.";
            }
          }

          linkerElement.href = fileDownloadUrl;

          fetch(fileDownloadUrl)
            .then((response) => {
              if (response.ok) {
                const contentLengthHeader =
                  response.headers.get("Content-Length");
                if (contentLengthHeader !== null) {
                  console.log("Request Data Size : " + contentLengthHeader);
                  const sizeInBytes = parseInt(contentLengthHeader);
                  const sizeInMb = (sizeInBytes / (1024 * 1024)).toFixed(3);
                  fileSizeElement.innerHTML = `File size: <strong>${sizeInMb} MB</strong>`;
                } else {
                  fileSizeElement.innerHTML =
                    "File size: <strong>undefined</strong>";
                }
              } else {
                throw new Error("File not found or inaccessible");
              }
            })
            .catch((error) => {
              console.error("Error fetching file size,", error);
              fileSizeElement.innerHTML = "File size: <strong>Error</strong>";
            });
        }
      } else {
        document.querySelector("#download").innerHTML =
          "Please specify a file name, Google Drive ID or file URL.";
      }
    </script>
  </body>
</html>
